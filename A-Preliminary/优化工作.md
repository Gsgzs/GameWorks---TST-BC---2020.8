# 优化工作

`前言：我们团队在游戏快要上线前后，时时刻刻想着应该对项目进行着哪些优化，因为我们知道游戏上线以后玩家的体验是很重要的，一旦游戏当中的难度没有把控好、游戏出了bug等等对于玩家来说可能会认为我们的游戏做的不好，失去玩下去的兴趣，这对于我们将是严重的损失。我们希望玩家认为我们的游戏有可玩性，有持续玩下去的兴趣，所以优化任务重中之重！`

为了优化工作，我们化身成为了玩家，只有我们自身多玩多体验了，才能和玩家产生共鸣！

## 优化加载

- 优化原因：我们对于进入游戏时的加载不是很满意，想让加载时速度提快点
- 优化过程
  - 我们通过网上查资料找到了一种让项目“瘦身”的方式
  - 借助白鹭的工具Texture Merger 可以让我们所有分开的图合成一张大的精灵图
  - 于是图片所占的内存减小了一些，但我们还是不满意
  - 决定对该大图进行一个合理压缩，同时也要保证图片在游戏内的美观，无法保证美观的就单独一个图放着

## 优化排行榜

- 优化原因：排行榜在初期做好了TOP100数据的时候，点击后需要等100条数据都渲染进去才会整个弹出展示给玩家看，这样就造成点击排行榜后会有黑一下的一段真空期
- 优化过程
  - 我们想要点击排行榜就直接弹出排行榜的框架
  - 最后的效果就是点击后排行榜白框直接弹出，然后需要等2秒左右的数据渲染进排行榜
  - 后来我们发现有个别现象是：点击排行榜后，数据信息需要等十来秒才会出现
  - 抱歉，我们无法解决，是一个遗憾！

## 优化游戏音效

- 优化原因：我们想给喜欢开游戏音效的玩家一个更好的音效体验
- 优化过程
  - 我们决定给左右按钮的点击加一个游戏音效，碰撞得分和游戏结束也各加一个音效
  - 碰撞得分选用的是原有素材里的add.mp3，按钮点击和游戏结束选择在网上查找素材音效
  - 完成后的音效体验应该是挺让人舒适的

## 优化游戏难度机制

- 优化原因：考虑到不同程度的玩家 玩家实力也不尽相同，也为了让玩家有更好的游戏体验

- 优化过程

  - 主要的难度设置就是“朱望仔”会随着点击按钮后的碰撞逐渐加速
    - 设定了三个阶段的加速：前中后期
    - 前期到中期较于中期到后期的进度较快，让玩家处于中期的时间较长
  - 我们需要设定初始速度值，初始速度变化值，通过调试判断出前期到达中期和中期到达后期分别所需要的的碰撞次数，通过判断点击按钮后的总碰撞次数对速度变化值进行修改（前期速度变化值 > 中期 > 后期）
  - 在调试记录碰撞次数的时候，发现快速点击按钮会一下触发多次碰撞次数的累加bug。解决方案：
    - 设定一个节流阀(初始为true)，为true才能发生让”朱望仔“碰撞回弹
    - 点击按钮和“朱望仔”发生碰撞回弹后，关闭节流阀(false)，判断朱望仔回弹需要达到的高度，高度达到后再开启节流阀(true)，这样就解决了 让点击按钮和“朱望仔”发生一次碰撞后一段过程内不能再发生碰撞，同时也不会有什么影响，也提高了游戏体验

  - 最终暂定前期到中期碰撞25次，中期到后期碰撞43次，一共碰撞68次到达后期，过程中判断碰撞次数对速度变化值进行修改
  - 同时对“朱望仔”回弹的角度也进行了修改，调小了原来最低回弹的角度，让角度可能的随机范围更广，提升随机性与游戏体验

## 优化游戏得分物机制

- 优化原因：上线后得分物的机制都是随着玩家的得分进行变化的，因为得分物是随机的，这样的话就很容易让运气成分影响玩家的得分从而触发得分物的机制，对于相同碰撞次数的玩家之间，分数可能存在较大差异，这是不合理的，所以需要一个合理的策略

- 优化过程

  - 想法：将机制随得分变化而变化，改为随碰撞次数变化而变化
    - 理由：这么做的话，即使相同碰撞次数的玩家之间，得分仍然会因为随机的原因有差异，但是因为大家的触发机制都是同阶段且相同的，这样前期运气可能不太好的玩家，后期也可能因为运气很容易追回来，控制了运气所占的比重提升玩家的体验

  - 得分物的数量机制
    - 数量机制共分4个阶段：由少到多
    - 前期速度慢生存率较高，后期速度快生存率变低，所以生存率变低理应让玩家也更容易得分
  - 数字得分物中心数字变化机制
    - 数字得分物的中心数字机制分4个阶段：数字随机范围从小到大
    - 数字随机范围随碰撞次数变化而变大，是一种难度的增加，同时也是因为数字得分物的数量会随数量机制变化而增加，这样数字增大也可以让“朱望仔”在上方碰撞可能停留的时间更长得分的机会更多

  - 数字得分物得分机制
    - 数字得分物前期碰撞每次+1，后期因为难度增加所以设立了得分奖励机制每次碰撞+2
  - 得分物的生成范围机制
    - 得分物随机生成的范围分为3个阶段：范围从大到小
    - 考虑到“朱望仔”速度较快时，碰撞的数字得分物较近时，容易快速向下回弹，给玩家的反应时间较低，因此让得分物随机的高度范围随碰撞次数(速度难度)变化而向上收缩，给予玩家一定的反应时间，提高玩家的存活概率提升玩家的游戏体验

## 优化游戏分享

- 优化原因：游戏域名需要借助官方提供的链接中转才能获取到微信用户信息，可是获取到信息的同时，链接的末尾也会带上该用户的信息，我们发现如果该用户进入游戏链接后，选择微信右上角的三个点分享出去的话，就会自然而然带上自身的信息，那么其他用户如果通过该分享出来的链接进入的话就会发现游戏内不是自己的头像与昵称，而是分享者的！

- 优化过程

  - 我们发现后意识到这个问题的严重性，马上展开讨论，但无果

  - 我们立马求助老师和学长，发现了解学习到有个很巧妙的办法可以解决这个问题

    - 在前端页面判断是否拿到了用户信息，没拿到就通过官方链接中转拿信息，直到拿到之后将信息存到内存数据，并直接跳转到我们的游戏域名链接

    - 拿到我们存好的信息数据进行渲染信息等操作
    - 那么如果用户再进行分享的话，就是直接通过我们的游戏域名进行分享，不会带上个人的信息，这样就可以实现安全分享

## 优化二维码长按

- 优化原因：在游戏结束后的成绩单页，里面的新网银行二维码无法长按识别
- 优化过程
  - 通过网上查找资料，发现出现问题的原因是直接使用白鹭添加的图片，不能够长按识别二维码
  - 既然知道了原因，那么接着就按照网上的方式进行尝试
  - 最后实现了二维码可以长按识别的功能













































